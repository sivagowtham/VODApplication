DROP TABLE "VODAPP"."TBL_MOVIE_COMMENTS";
DROP TABLE "VODAPP"."TBL_MOVIE_PURCHASED";
DROP TABLE "VODAPP"."TBL_RENTED_MOVIES";
DROP TABLE "VODAPP"."TBL_TRANSACTIONS";
DROP TABLE "VODAPP"."TBL_USER_FAVORITES";
DROP TABLE "VODAPP"."TBL_USER_RECOMMENDATIONS";
DROP TABLE "VODAPP"."TBL_WATCH_HISTORY";
DROP TABLE "VODAPP"."TBL_USERS";
DROP TABLE "VODAPP"."TBL_MOVIES";
DROP TABLE "VODAPP"."TBL_CREDIT_CARD_INFO";


CREATE TABLE "VODAPP"."TBL_CREDIT_CARD_INFO" (
  CREDIT_CARD_ID INT NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  NAME VARCHAR(100) NOT NULL,
  CREDIT_CARD_NUMBER VARCHAR(45) NOT NULL,
  CREDIT_CARD_TYPE VARCHAR(45) NOT NULL,
  SECURITY_CODE VARCHAR(45) NOT NULL,
  EXPIRY_MONTH VARCHAR(45) NOT NULL,
  EXPIRY_YEAR VARCHAR(45) NOT NULL
);

CREATE TABLE "VODAPP"."TBL_USERS"
(
   USER_ID INT NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
   USERNAME VARCHAR(45) NOT NULL UNIQUE,
   PASSWORD VARCHAR(45) NOT NULL,
   FIRST_NAME VARCHAR(45) NOT NULL,
   LAST_NAME VARCHAR(45) NOT NULL,
   EMAIL VARCHAR(100) NOT NULL UNIQUE,
   CREDIT_CARD_ID INT NOT NULL,
   ISACTIVE CHAR(1) NOT NULL DEFAULT '0',
   ISADMIN CHAR(1) NOT NULL DEFAULT '0',
  CONSTRAINT FK_USER_CREDIT_ID FOREIGN KEY (CREDIT_CARD_ID) REFERENCES TBL_CREDIT_CARD_INFO (CREDIT_CARD_ID) ON DELETE NO ACTION 
);

CREATE TABLE "VODAPP"."TBL_MOVIES"
(
   MOVIE_ID INT NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
   TITLE VARCHAR(100) NOT NULL,
   DESCRIPTION VARCHAR(1000),
   DIRECTOR VARCHAR(100),
   ACTORS VARCHAR(500),
   CATEGORY VARCHAR(500) NOT NULL,
   RATING SMALLINT DEFAULT 0,
   VIDEO_URL VARCHAR(500) DEFAULT NULL,
   IMDB_ID VARCHAR(45) DEFAULT NULL,
   ADDED_ON DATE NOT NULL,
   RENT_AMOUNT DECIMAL(5,2) NOT NULL,
   RENT_TIME INT NOT NULL DEFAULT 30,
   PURCHASE_AMOUNT DECIMAL(5,2) NOT NULL,
   IS_VISIBLE CHAR NOT NULL,
   MOVIE_POSTER VARCHAR(25)
);

CREATE TABLE "VODAPP"."TBL_MOVIE_PURCHASED"
(
  PURCHASED_ID INT NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  MOVIE_ID INT NOT NULL,
  USER_ID INT NOT NULL,
  PURCHASED_ON DATE NOT NULL,
  CONSTRAINT FK_PUR_USER_ID FOREIGN KEY (USER_ID) REFERENCES TBL_USERS (USER_ID) ON DELETE NO ACTION ,
  CONSTRAINT FK_PUR_MOVIE_ID FOREIGN KEY (MOVIE_ID) REFERENCES TBL_MOVIES (MOVIE_ID) ON DELETE NO ACTION 
); 



CREATE TABLE "VODAPP"."TBL_MOVIE_COMMENTS"
(
   COMMENT_ID INT NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
   MOVIE_ID INT NOT NULL,
   CREATED_BY INT NOT NULL,
   COMMENT_TEXT VARCHAR(200) NOT NULL,
   CREATED_ON DATE NOT NULL,
   CONSTRAINT FK_MOVIE_ID FOREIGN KEY(MOVIE_ID)
   REFERENCES TBL_MOVIES (MOVIE_ID) ON DELETE NO ACTION,
   CONSTRAINT FK_USER_ID FOREIGN KEY(CREATED_BY)
   REFERENCES TBL_USERS (USER_ID) ON DELETE NO ACTION
);

CREATE TABLE "VODAPP"."TBL_RENTED_MOVIES"
(
   RENTED_ID INT NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
   MOVIE_ID INT NOT NULL,
   USER_ID INT NOT NULL,
   RENTED_ON DATE NOT NULL,
   CONSTRAINT FK_RENT_MOVIE_ID FOREIGN KEY(MOVIE_ID)
   REFERENCES TBL_MOVIES (MOVIE_ID) ON DELETE NO ACTION ,
   CONSTRAINT FK_RENT_USER_ID FOREIGN KEY(USER_ID)
   REFERENCES TBL_USERS (USER_ID) ON DELETE NO ACTION
);

CREATE TABLE "VODAPP"."TBL_USER_FAVORITES"
(
   FAVORITE_ID INT NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
   MOVIE_ID INT NOT NULL,
   USER_ID INT NOT NULL,
   CONSTRAINT FK_FAV_MOVIE_ID FOREIGN KEY(MOVIE_ID)
   REFERENCES TBL_MOVIES (MOVIE_ID) ON DELETE CASCADE,
   CONSTRAINT FK_FAV_USER_ID FOREIGN KEY(USER_ID)
   REFERENCES TBL_USERS (USER_ID) ON DELETE CASCADE
);

CREATE TABLE "VODAPP"."TBL_USER_RECOMMENDATIONS" (
  RECOMMENDATION_ID INT NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  MOVIE_ID INT NOT NULL,
  USER_ID INT NOT NULL,
  CONSTRAINT FK_REC_MOVIE_ID FOREIGN KEY (MOVIE_ID) REFERENCES TBL_MOVIES (MOVIE_ID) ON DELETE CASCADE,
  CONSTRAINT FK_REC_USER_ID FOREIGN KEY (USER_ID) REFERENCES TBL_USERS (USER_ID) ON DELETE CASCADE
);

CREATE TABLE "VODAPP"."TBL_WATCH_HISTORY" (
  MOVIE_ID INT NOT NULL,
  USER_ID INT NOT NULL,
  WATCHED_ON DATE NOT NULL,
  CONSTRAINT FK_HIST_MOVIE_ID FOREIGN KEY (MOVIE_ID) REFERENCES TBL_MOVIES (MOVIE_ID) ON DELETE CASCADE,
  CONSTRAINT FK_HIST_USER_ID FOREIGN KEY (USER_ID) REFERENCES TBL_USERS (USER_ID) ON DELETE CASCADE
);

CREATE TABLE "VODAPP"."TBL_TRANSACTIONS" (
  TRANSACTION_ID INT NOT NULL GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  USER_ID INT NOT NULL,
  MOVIE_ID INT DEFAULT 0,
  TRANSACTION_TYPE VARCHAR(45) NOT NULL,
  TRANSACTION_AMOUNT DECIMAL(5,2) NOT NULL,
  TRANSACTION_DATE DATE NOT NULL,
  CONSTRAINT FK_TRAN_USER_ID FOREIGN KEY (USER_ID) REFERENCES TBL_USERS (USER_ID) ON DELETE NO ACTION,
  CONSTRAINT FK_TRAN_MOVIE_ID FOREIGN KEY (MOVIE_ID) REFERENCES TBL_MOVIES (MOVIE_ID) ON DELETE NO ACTION
);




INSERT INTO "VODAPP"."TBL_CREDIT_CARD_INFO" (NAME,CREDIT_CARD_NUMBER,CREDIT_CARD_TYPE, SECURITY_CODE,EXPIRY_MONTH,EXPIRY_YEAR) VALUES ('test name','1234567891011121', 'VISA', '123','01','1700');



INSERT INTO "VODAPP"."TBL_USERS" (USERNAME, PASSWORD, FIRST_NAME, LAST_NAME, EMAIL, CREDIT_CARD_ID, ISACTIVE, ISADMIN) VALUES ('abhishek', 'pass123', 'Abhishek', 'Poonia', 'abhishekpoonia31@gmail.com', 1, '1', '1');
INSERT INTO "VODAPP"."TBL_USERS" (USERNAME, PASSWORD, FIRST_NAME, LAST_NAME, EMAIL, CREDIT_CARD_ID, ISACTIVE, ISADMIN) VALUES ('amber', 'pass123', 'Amber', 'Gullatte ', 'aag095020@utdallas.edu', 1, '1', '1');
INSERT INTO "VODAPP"."TBL_USERS" (USERNAME, PASSWORD, FIRST_NAME, LAST_NAME, EMAIL, CREDIT_CARD_ID, ISACTIVE, ISADMIN) VALUES ('lei', 'pass123', 'Lei', 'Cui', 'special.lei@gmail.com', 1, '1', '1');
INSERT INTO "VODAPP"."TBL_USERS" (USERNAME, PASSWORD, FIRST_NAME, LAST_NAME, EMAIL, CREDIT_CARD_ID, ISACTIVE, ISADMIN) VALUES ('gowthamsivan', 'pass123', 'Gowthamsivan', 'Sivagnanam', 'siva.gowtham@gmail.com', 1, '1', '1');
INSERT INTO "VODAPP"."TBL_USERS" (USERNAME, PASSWORD, FIRST_NAME, LAST_NAME, EMAIL, CREDIT_CARD_ID, ISACTIVE, ISADMIN) VALUES ('guilherme', 'pass123', 'Guilherme', 'Rosa', 'gcr091020@gmail.com', 1, '1', '1');
INSERT INTO "VODAPP"."TBL_USERS" (USERNAME, PASSWORD, FIRST_NAME, LAST_NAME, EMAIL, CREDIT_CARD_ID, ISACTIVE, ISADMIN) VALUES ('kefei', 'pass123', 'Kefei', 'Ma', 'makefeics@gmail.com', 1, '1', '1');
INSERT INTO "VODAPP"."TBL_USERS" (USERNAME, PASSWORD, FIRST_NAME, LAST_NAME, EMAIL, CREDIT_CARD_ID, ISACTIVE, ISADMIN) VALUES ('mahalakshmi', 'pass123', 'Mahalakshmi', 'Balasubramanian', 'bmaha05@gmail.com', 1, '1', '1');
INSERT INTO "VODAPP"."TBL_USERS" (USERNAME, PASSWORD, FIRST_NAME, LAST_NAME, EMAIL, CREDIT_CARD_ID, ISACTIVE, ISADMIN) VALUES ('michael', 'pass123', 'Michael', 'Christiansen', 'michael.christiansen@utdallas.edu', 1, '1', '1');
INSERT INTO "VODAPP"."TBL_USERS" (USERNAME, PASSWORD, FIRST_NAME, LAST_NAME, EMAIL, CREDIT_CARD_ID, ISACTIVE, ISADMIN) VALUES ('user', 'pass123', 'test', 'user', 'test.user@gmail.com', 1,  '1', '0');

