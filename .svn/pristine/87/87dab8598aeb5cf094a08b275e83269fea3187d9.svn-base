-- ============================

-- This file was created using Derby's dblook utility.
-- Timestamp: 2014-07-08 02:27:53.832
-- Source database is: voddb
-- Connection URL is: jdbc:derby://localhost:1527/voddb
-- appendLogs: false

-- ----------------------------------------------
-- DDL Statements for schemas
-- ----------------------------------------------

--Check whether table exists or not before DROP Statement because Derby doesnt have DROP TABLE IF EXISTS-----

--DROP table in following sequence---
DROP TABLE "VODAPP"."TBL_USER_RECOMMENDATIONS";

DROP TABLE "VODAPP"."TBL_MOVIE_COMMENTS";

DROP TABLE "VODAPP"."TBL_WATCH_HISTORY";

DROP TABLE "VODAPP"."TBL_RENTED_MOVIES";

DROP TABLE "VODAPP"."TBL_MOVIE_PURCHASED";

DROP TABLE "VODAPP"."TBL_USER_FAVORITES";

DROP TABLE "VODAPP"."TBL_TRANSACTIONS";

DROP TABLE "VODAPP"."TBL_MOVIES";

DROP TABLE "VODAPP"."TBL_USERS";

DROP TABLE "VODAPP"."TBL_CREDIT_CARD_INFO";

-- Schema can only be dropped once you dropped all tables in schema i.e. schema must be empty before drop.---
DROP SCHEMA "VODAPP" RESTRICT;


-- Now we can run the below script as a whole without any error---

CREATE SCHEMA "VODAPP";

-- ----------------------------------------------
-- DDL Statements for tables
-- ----------------------------------------------

CREATE TABLE "VODAPP"."TBL_USER_RECOMMENDATIONS" ("RECOMMENDATION_ID" INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1), "MOVIE_ID" INTEGER NOT NULL, "USER_ID" INTEGER NOT NULL);

CREATE TABLE "VODAPP"."TBL_MOVIE_COMMENTS" ("COMMENT_ID" INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1), "MOVIE_ID" INTEGER NOT NULL, "CREATED_BY" INTEGER NOT NULL, "COMMENT_TEXT" VARCHAR(200) NOT NULL, "CREATED_ON" DATE NOT NULL);

CREATE TABLE "VODAPP"."TBL_WATCH_HISTORY" ("MOVIE_ID" INTEGER NOT NULL, "USER_ID" INTEGER NOT NULL, "WATCHED_ON" DATE NOT NULL);

CREATE TABLE "VODAPP"."TBL_RENTED_MOVIES" ("RENTED_ID" INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1), "MOVIE_ID" INTEGER NOT NULL, "USER_ID" INTEGER NOT NULL, "RENTED_ON" DATE NOT NULL);

CREATE TABLE "VODAPP"."TBL_MOVIES" ("MOVIE_ID" INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1), "TITLE" VARCHAR(100) NOT NULL, "DESCRIPTION" VARCHAR(1000) NOT NULL, "DIRECTOR" VARCHAR(100) NOT NULL, "ACTORS" VARCHAR(500) NOT NULL, "CATEGORY" VARCHAR(500) NOT NULL, "ADDED_ON" DATE NOT NULL, "RENT_AMOUNT" DECIMAL(5,2) NOT NULL DEFAULT 30.00, "PURCHASE_AMOUNT" DECIMAL(5,2) NOT NULL DEFAULT 100.00, "POSTER_URL" VARCHAR(250), "RATING" DECIMAL(5,2) NOT NULL DEFAULT 0.00, "VIDEO_URL" VARCHAR(500), "IMDB_ID" VARCHAR(45), "IS_VISIBLE" VARCHAR(1) NOT NULL, "NUM_TIMES_RATED" INT);

CREATE TABLE "VODAPP"."TBL_CREDIT_CARD_INFO" ("CREDIT_CARD_ID" INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1), "NAME" VARCHAR(100) NOT NULL, "CREDIT_CARD_NUMBER" VARCHAR(45) NOT NULL, "CREDIT_CARD_TYPE" VARCHAR(45) NOT NULL, "SECURITY_CODE" VARCHAR(45) NOT NULL, "EXPIRY_MONTH" VARCHAR(45) NOT NULL, "EXPIRY_YEAR" VARCHAR(45) NOT NULL);

CREATE TABLE "VODAPP"."TBL_TRANSACTIONS" ("TRANSACTION_ID" INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1), "USER_ID" INTEGER NOT NULL, "MOVIE_ID" INTEGER DEFAULT 0, "TRANSACTION_TYPE" VARCHAR(45) NOT NULL, "TRANSACTION_AMOUNT" DECIMAL(5,2) NOT NULL, "TRANSACTION_DATE" DATE NOT NULL);

CREATE TABLE "VODAPP"."TBL_MOVIE_PURCHASED" ("PURCHASED_ID" INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1), "MOVIE_ID" INTEGER NOT NULL, "USER_ID" INTEGER NOT NULL, "PURCHASED_ON" DATE NOT NULL);

CREATE TABLE "VODAPP"."TBL_USER_FAVORITES" ("FAVORITE_ID" INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1), "MOVIE_ID" INTEGER NOT NULL, "USER_ID" INTEGER NOT NULL);

CREATE TABLE "VODAPP"."TBL_USERS" ("USER_ID" INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1), "USERNAME" VARCHAR(45) NOT NULL, "PASSWORD" VARCHAR(45) NOT NULL, "FIRST_NAME" VARCHAR(45) NOT NULL, "LAST_NAME" VARCHAR(45) NOT NULL, "EMAIL" VARCHAR(100) NOT NULL, "CREDIT_CARD_ID" INTEGER NOT NULL, "ISACTIVE" VARCHAR(10) DEFAULT '0', "ISADMIN" VARCHAR(10) DEFAULT '0');

-- ----------------------------------------------
-- DDL Statements for keys
-- ----------------------------------------------

-- PRIMARY/UNIQUE
ALTER TABLE "VODAPP"."TBL_RENTED_MOVIES" ADD CONSTRAINT "SQL140705004509820" PRIMARY KEY ("RENTED_ID");

ALTER TABLE "VODAPP"."TBL_TRANSACTIONS" ADD CONSTRAINT "SQL140705004532330" PRIMARY KEY ("TRANSACTION_ID");

ALTER TABLE "VODAPP"."TBL_MOVIE_COMMENTS" ADD CONSTRAINT "SQL140705004503570" PRIMARY KEY ("COMMENT_ID");

ALTER TABLE "VODAPP"."TBL_USER_RECOMMENDATIONS" ADD CONSTRAINT "SQL140705004520610" PRIMARY KEY ("RECOMMENDATION_ID");

ALTER TABLE "VODAPP"."TBL_MOVIES" ADD CONSTRAINT "SQL140705004453580" PRIMARY KEY ("MOVIE_ID");

ALTER TABLE "VODAPP"."TBL_CREDIT_CARD_INFO" ADD CONSTRAINT "SQL140705004442290" PRIMARY KEY ("CREDIT_CARD_ID");

ALTER TABLE "VODAPP"."TBL_MOVIE_PURCHASED" ADD CONSTRAINT "SQL140705004457660" PRIMARY KEY ("PURCHASED_ID");

ALTER TABLE "VODAPP"."TBL_USERS" ADD CONSTRAINT "SQL140705004447610" PRIMARY KEY ("USER_ID");

ALTER TABLE "VODAPP"."TBL_USERS" ADD CONSTRAINT "SQL140705004447611" UNIQUE ("USERNAME");

ALTER TABLE "VODAPP"."TBL_USERS" ADD CONSTRAINT "SQL140705004447612" UNIQUE ("EMAIL");

ALTER TABLE "VODAPP"."TBL_USER_FAVORITES" ADD CONSTRAINT "SQL140705004515140" PRIMARY KEY ("FAVORITE_ID");

-- FOREIGN
ALTER TABLE "VODAPP"."TBL_RENTED_MOVIES" ADD CONSTRAINT "FK_RENT_MOVIE_ID" FOREIGN KEY ("MOVIE_ID") REFERENCES "VODAPP"."TBL_MOVIES" ("MOVIE_ID") ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE "VODAPP"."TBL_RENTED_MOVIES" ADD CONSTRAINT "FK_RENT_USER_ID" FOREIGN KEY ("USER_ID") REFERENCES "VODAPP"."TBL_USERS" ("USER_ID") ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE "VODAPP"."TBL_WATCH_HISTORY" ADD CONSTRAINT "FK_HIST_MOVIE_ID" FOREIGN KEY ("MOVIE_ID") REFERENCES "VODAPP"."TBL_MOVIES" ("MOVIE_ID") ON DELETE CASCADE ON UPDATE NO ACTION;

ALTER TABLE "VODAPP"."TBL_WATCH_HISTORY" ADD CONSTRAINT "FK_HIST_USER_ID" FOREIGN KEY ("USER_ID") REFERENCES "VODAPP"."TBL_USERS" ("USER_ID") ON DELETE CASCADE ON UPDATE NO ACTION;

ALTER TABLE "VODAPP"."TBL_TRANSACTIONS" ADD CONSTRAINT "FK_TRAN_USER_ID" FOREIGN KEY ("USER_ID") REFERENCES "VODAPP"."TBL_USERS" ("USER_ID") ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE "VODAPP"."TBL_TRANSACTIONS" ADD CONSTRAINT "FK_TRAN_MOVIE_ID" FOREIGN KEY ("MOVIE_ID") REFERENCES "VODAPP"."TBL_MOVIES" ("MOVIE_ID") ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE "VODAPP"."TBL_MOVIE_COMMENTS" ADD CONSTRAINT "FK_MOVIE_ID" FOREIGN KEY ("MOVIE_ID") REFERENCES "VODAPP"."TBL_MOVIES" ("MOVIE_ID") ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE "VODAPP"."TBL_MOVIE_COMMENTS" ADD CONSTRAINT "FK_USER_ID" FOREIGN KEY ("CREATED_BY") REFERENCES "VODAPP"."TBL_USERS" ("USER_ID") ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE "VODAPP"."TBL_USER_RECOMMENDATIONS" ADD CONSTRAINT "FK_REC_MOVIE_ID" FOREIGN KEY ("MOVIE_ID") REFERENCES "VODAPP"."TBL_MOVIES" ("MOVIE_ID") ON DELETE CASCADE ON UPDATE NO ACTION;

ALTER TABLE "VODAPP"."TBL_USER_RECOMMENDATIONS" ADD CONSTRAINT "FK_REC_USER_ID" FOREIGN KEY ("USER_ID") REFERENCES "VODAPP"."TBL_USERS" ("USER_ID") ON DELETE CASCADE ON UPDATE NO ACTION;

ALTER TABLE "VODAPP"."TBL_MOVIE_PURCHASED" ADD CONSTRAINT "FK_PUR_USER_ID" FOREIGN KEY ("USER_ID") REFERENCES "VODAPP"."TBL_USERS" ("USER_ID") ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE "VODAPP"."TBL_MOVIE_PURCHASED" ADD CONSTRAINT "FK_PUR_MOVIE_ID" FOREIGN KEY ("MOVIE_ID") REFERENCES "VODAPP"."TBL_MOVIES" ("MOVIE_ID") ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE "VODAPP"."TBL_USERS" ADD CONSTRAINT "FK_USER_CREDIT_ID" FOREIGN KEY ("CREDIT_CARD_ID") REFERENCES "VODAPP"."TBL_CREDIT_CARD_INFO" ("CREDIT_CARD_ID") ON DELETE NO ACTION ON UPDATE NO ACTION;

ALTER TABLE "VODAPP"."TBL_USER_FAVORITES" ADD CONSTRAINT "FK_FAV_MOVIE_ID" FOREIGN KEY ("MOVIE_ID") REFERENCES "VODAPP"."TBL_MOVIES" ("MOVIE_ID") ON DELETE CASCADE ON UPDATE NO ACTION;

ALTER TABLE "VODAPP"."TBL_USER_FAVORITES" ADD CONSTRAINT "FK_FAV_USER_ID" FOREIGN KEY ("USER_ID") REFERENCES "VODAPP"."TBL_USERS" ("USER_ID") ON DELETE CASCADE ON UPDATE NO ACTION;


-- DATA INSERTION
INSERT INTO "VODAPP"."TBL_MOVIES" (TITLE,DESCRIPTION,DIRECTOR,ACTORS,CATEGORY,ADDED_ON,POSTER_URL,VIDEO_URL,IMDB_ID,IS_VISIBLE) VALUES ('X-Men: Days of Future Past','The X-Men send Wolverine to the past in a desperate effort to change history and prevent an event that results in doom for both humans and mutants.','Bryan Singer','Hugh Jackman, James McAvoy, Michael Fassbender, Jennifer Lawrence','Action, Adventure, Sci-Fi',{d '2014-07-05'},'http://ia.media-imdb.com/images/M/MV5BMTA2MDU0MjUxNDNeQTJeQWpwZ15BbWU4MDEwOTAwNTAx._V1_SX300.jpg','movie03.mp4','tt1877832','Y');
INSERT INTO "VODAPP"."TBL_MOVIES" (TITLE,DESCRIPTION,DIRECTOR,ACTORS,CATEGORY,ADDED_ON,POSTER_URL,VIDEO_URL,IMDB_ID,IS_VISIBLE) VALUES ('Transcendence','A scientist''s drive for artificial intelligence, takes on dangerous implications when his consciousness is uploaded into one such program.','Wally Pfister','Johnny Depp, Rebecca Hall, Paul Bettany, Cillian Murphy','Drama, Mystery, Sci-Fi',{d '2014-07-05'},'http://ia.media-imdb.com/images/M/MV5BMTc1MjQ3ODAyOV5BMl5BanBnXkFtZTgwNjI1NDQ0MTE@._V1_SX300.jpg','movie01.mp4','tt2209764','Y');
INSERT INTO "VODAPP"."TBL_MOVIES" (TITLE,DESCRIPTION,DIRECTOR,ACTORS,CATEGORY,ADDED_ON,POSTER_URL,VIDEO_URL,IMDB_ID,IS_VISIBLE) VALUES ('Godzilla','An enormous, radioactively mutated lizard runs rampant in Manhattan.','Roland Emmerich','Matthew Broderick, Jean Reno, Maria Pitillo, Hank Azaria','Action, Sci-Fi, Thriller',{d '2014-07-05'},'http://ia.media-imdb.com/images/M/MV5BMTgyMjE1NDczN15BMl5BanBnXkFtZTYwNDIwNjg5._V1_SX300.jpg','movie02.mp4','tt0120685','Y');
INSERT INTO "VODAPP"."TBL_MOVIES" (TITLE,DESCRIPTION,DIRECTOR,ACTORS,CATEGORY,ADDED_ON,POSTER_URL,VIDEO_URL,IMDB_ID,IS_VISIBLE) VALUES ('Captain America: The Winter Soldier','Steve Rogers struggles to embrace his role in the modern world and battles a new threat from old history: the Soviet agent known as the Winter Soldier.','Anthony Russo, Joe Russo','Chris Evans, Samuel L. Jackson, Scarlett Johansson, Robert Redford','Action, Adventure, Sci-Fi',{d '2014-07-05'},'http://ia.media-imdb.com/images/M/MV5BMzA2NDkwODAwM15BMl5BanBnXkFtZTgwODk5MTgzMTE@._V1_SX300.jpg','movie04.mp4','tt1843866','Y');
INSERT INTO "VODAPP"."TBL_MOVIES" (TITLE,DESCRIPTION,DIRECTOR,ACTORS,CATEGORY,ADDED_ON,POSTER_URL,VIDEO_URL,IMDB_ID,IS_VISIBLE) VALUES ('The Social Network','Harvard student Mark Zuckerberg creates the social networking site that would become known as Facebook, but is later sued by two brothers who claimed he stole their idea, and the cofounder who was later squeezed out of the business.','David Fincher','Jesse Eisenberg, Rooney Mara, Bryan Barter, Dustin Fitzsimons','Biography, Drama',{d '2014-07-08'},'http://ia.media-imdb.com/images/M/MV5BMTM2ODk0NDAwMF5BMl5BanBnXkFtZTcwNTM1MDc2Mw@@._V1_SX300.jpg','movie05.mp4','tt1285016','Y');

INSERT INTO "VODAPP"."TBL_CREDIT_CARD_INFO" (NAME,CREDIT_CARD_NUMBER,CREDIT_CARD_TYPE, SECURITY_CODE,EXPIRY_MONTH,EXPIRY_YEAR) VALUES ('test name','1234567891011121', 'VISA', '123','01','1700');
INSERT INTO "VODAPP"."TBL_CREDIT_CARD_INFO" (NAME,CREDIT_CARD_NUMBER,CREDIT_CARD_TYPE, SECURITY_CODE,EXPIRY_MONTH,EXPIRY_YEAR) VALUES ('ADMIN','1234567891011121', 'VISA', '123','01','1700');

INSERT INTO "VODAPP"."TBL_USERS" (USERNAME, PASSWORD, FIRST_NAME, LAST_NAME, EMAIL, CREDIT_CARD_ID, ISACTIVE, ISADMIN) VALUES ('abhishek', 'pass123', 'Abhishek', 'Poonia', 'abhishekpoonia31@gmail.com', 1, '1', '1');
INSERT INTO "VODAPP"."TBL_USERS" (USERNAME, PASSWORD, FIRST_NAME, LAST_NAME, EMAIL, CREDIT_CARD_ID, ISACTIVE, ISADMIN) VALUES ('amber', 'pass123', 'Amber', 'Gullatte ', 'aag095020@utdallas.edu', 1, '1', '1');
INSERT INTO "VODAPP"."TBL_USERS" (USERNAME, PASSWORD, FIRST_NAME, LAST_NAME, EMAIL, CREDIT_CARD_ID, ISACTIVE, ISADMIN) VALUES ('lei', 'pass123', 'Lei', 'Cui', 'special.lei@gmail.com', 1, '1', '1');
INSERT INTO "VODAPP"."TBL_USERS" (USERNAME, PASSWORD, FIRST_NAME, LAST_NAME, EMAIL, CREDIT_CARD_ID, ISACTIVE, ISADMIN) VALUES ('gowthamsivan', 'pass123', 'Gowthamsivan', 'Sivagnanam', 'siva.gowtham@gmail.com', 1, '1', '1');
INSERT INTO "VODAPP"."TBL_USERS" (USERNAME, PASSWORD, FIRST_NAME, LAST_NAME, EMAIL, CREDIT_CARD_ID, ISACTIVE, ISADMIN) VALUES ('guilherme', 'pass123', 'Guilherme', 'Rosa', 'gcr091020@gmail.com', 1, '1', '1');
INSERT INTO "VODAPP"."TBL_USERS" (USERNAME, PASSWORD, FIRST_NAME, LAST_NAME, EMAIL, CREDIT_CARD_ID, ISACTIVE, ISADMIN) VALUES ('kefei', 'pass123', 'Kefei', 'Ma', 'makefeics@gmail.com', 1, '1', '1');
INSERT INTO "VODAPP"."TBL_USERS" (USERNAME, PASSWORD, FIRST_NAME, LAST_NAME, EMAIL, CREDIT_CARD_ID, ISACTIVE, ISADMIN) VALUES ('mahalakshmi', 'pass123', 'Mahalakshmi', 'Balasubramanian', 'bmaha05@gmail.com', 1, '1', '1');
INSERT INTO "VODAPP"."TBL_USERS" (USERNAME, PASSWORD, FIRST_NAME, LAST_NAME, EMAIL, CREDIT_CARD_ID, ISACTIVE, ISADMIN) VALUES ('michael', 'pass123', 'Michael', 'Christiansen', 'michael.christiansen@utdallas.edu', 1, '1', '1');
INSERT INTO "VODAPP"."TBL_USERS" (USERNAME, PASSWORD, FIRST_NAME, LAST_NAME, EMAIL, CREDIT_CARD_ID, ISACTIVE, ISADMIN) VALUES ('user', 'pass123', 'test', 'user', 'test.user@gmail.com', 1,  '1', '0');
